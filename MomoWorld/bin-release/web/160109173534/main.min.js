var Bullet=function(){function t(t,e,i,a,o){this._name="1",this.speed=0,this.originX=0,this.toward=1,this.isOver=!1,this._name=t,this.speed=e,this.toward=i,this.data=getBullet(this._name),this.show=Tool.addBitmap(UIManage.target.item,this.data.name+"_png",a,o,0,0,!1),this.show.anchorOffsetX=this.show.width/2,this.show.anchorOffsetY=this.show.height/2,this.show.scaleX=this.toward,this.originX=a}var e=(__define,t);return p=e.prototype,p.syncFun=function(){this.show.x-=this.speed*this.toward;var t=Math.abs(this.show.x-this.originX);t>this.data.range-50&&(this.show.alpha=(this.data.range-t)/50),t>this.data.range&&(this.isOver=!0)},t}();egret.registerClass(Bullet,"Bullet");var getBullet=function(t){return"1"==t?bullet1:void 0},bullet1={name:"bullet1",range:350},daily={date:"0001",items:[{icon:"daily_icon1_png",detail:"任务1",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"daily_icon2_png",detail:"任务2",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"daily_icon3_png",detail:"任务3",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"daily_icon4_png",detail:"任务4",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"daily_icon5_png",detail:"任务5",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"}]},achievement={date:"0001",items:[{icon:"achievement_icon1_png",detail:"成就1",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"achievement_icon2_png",detail:"成就2",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"achievement_icon3_png",detail:"成就3",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"achievement_icon4_png",detail:"成就4",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"},{icon:"achievement_icon5_png",detail:"成就5",gift:"奖励",type:"奖励类型",num:30,ques:5,state:"go"}]},ability={skill1:[{icon:"ability_skill1_1_png",skill:"技能1",name:"单攻技能1",intruction:"单攻技能1简介",level:0,maxLevel:25},{icon:"ability_skill1_2_png",skill:"技能2",name:"单攻技能2",intruction:"单攻技能2简介",level:0,maxLevel:30},{icon:"ability_skill1_3_png",skill:"技能3",name:"单攻技能3",intruction:"单攻技能3简介",level:0,maxLevel:30},{icon:"ability_skill1_4_png",skill:"技能4",name:"单攻技能4",intruction:"单攻技能4简介",level:0,maxLevel:30},{icon:"ability_skill1_5_png",skill:"技能5",name:"单攻技能5",intruction:"单攻技能5简介",level:0,maxLevel:30}],skill2:[{icon:"ability_skill2_1_png",skill:"技能1",name:"群攻技能1",intruction:"群攻技能1简介",level:0,maxLevel:30},{icon:"ability_skill2_2_png",skill:"技能2",name:"群攻技能2",intruction:"群攻技能2简介",level:0,maxLevel:30},{icon:"ability_skill2_3_png",skill:"技能3",name:"群攻技能3",intruction:"群攻技能3简介",level:0,maxLevel:30},{icon:"ability_skill2_4_png",skill:"技能4",name:"群攻技能4",intruction:"群攻技能4简介",level:0,maxLevel:30},{icon:"ability_skill2_5_png",skill:"技能5",name:"群攻技能5",intruction:"群攻技能5简介",level:0,maxLevel:30}],data:[{icon:"ability_boold",type:"血量",name:"血量",intruction:"血量简介",state:1,level:0,maxLevel:30},{icon:"ability_power",type:"法力",name:"法力",intruction:"法力简介",state:1,level:0,maxLevel:30},{icon:"ability_attack",type:"普攻",name:"普攻",intruction:"普攻简介",state:1,level:0,maxLevel:30},{icon:"ability_defense1_",type:"物抗",name:"物抗",intruction:"物抗简介",state:1,level:0,maxLevel:30},{icon:"ability_defense2_",type:"法抗",name:"法抗",intruction:"法抗简介",state:1,level:0,maxLevel:30}]},drupShop={items:[{icon:"achievement_icon1_png",name:"药品1",info:"恢复HP50",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"药品1",info:"恢复HP50",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"药品1",info:"恢复HP50",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"药品1",info:"恢复HP50",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"药品1",info:"恢复HP50",cost:30,ques:5,state:"go"}]},weaponShop={items:[{icon:"achievement_icon1_png",name:"武器1",info:"攻击力+100",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"武器2",info:"攻击力+200",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"武器3",info:"攻击力+300",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"武器4",info:"攻击力+400",cost:30,ques:5,state:"go"},{icon:"achievement_icon1_png",name:"武器5",info:"攻击力+500",cost:30,ques:5,state:"go"}]},Enemy=function(t){function e(e,i){t.call(this),this.offsetX=0,this.offsetY=0,this.blood=1,this.toward=1,this.moveTime=0,this.standTime=0,this.hitCD=0,this.actionType="",this.mcType="",this._name="empty",this.isDie=!1,this.isSkill=!1,this.isAngry=!1,this.isMissing=!1,this.init(e,i)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(t,e){this._name=t,this.data=getEnemy(this._name),this.blood=this.data.blood,this.show=Tool.addMoveClip(this,this.data.name,"stand",0,0,1,-1,!0),this.body=P2Tool.createBox(this,World.P2World,e,50,GameData.bodyWidth,GameData.bodyWidth,"testColor_png",!1),this.body.shapes[0].collisionGroup=2,this.body.shapes[0].collisionMask=1,this.setChildIndex(this.show,99),this.action("stand")},p.syncFun=function(){if(this.blood<0&&!this.isDie&&this.action("die"),!this.isDie)if(this.checkHit(),P2Tool.syncDisplay(this.body),this.show.x=P2Tool.getEgretNum(this.body.position[0])+this.offsetX*this.toward,this.show.y=P2Tool.getEgretY(this.body.position[1])+this.offsetY,"walk"==this.actionType){if(this.isAngry){var t=function(){Hero.getInstance().body.position[0]>this.body.position[0]+P2Tool.getP2Num(50)?this.toward=-1:Hero.getInstance().body.position[0]<this.body.position[0]-P2Tool.getP2Num(50)&&(this.toward=1),this.show.scaleX=this.toward,this.body.position[0]-=P2Tool.getP2Num(this.data.walk.speed*this.toward)}.bind(this);if(null==this.data.attack)t();else{var e=Math.abs(P2Tool.getEgretNum(this.body.position[0])-P2Tool.getEgretNum(Hero.getInstance().body.position[0]));e<this.data.attack.range?this.action("attack"):t()}return}this.moveTime--;var i=this.show.measuredWidth/2-this.offsetX*this.toward,a=UIManage.target.tureWidth;this.show.x>i&&this.show.x<a-i&&(this.body.position[0]-=P2Tool.getP2Num(this.data.walk.speed*this.toward)),this.moveTime<0&&(this.body.velocity[0]=0,this.action("stand"))}else"stand"==this.actionType?(this.standTime--,0==this.standTime&&this.action("walk")):"hit"==this.actionType&&(this.hitCD--,0==this.hitCD&&this.action("walk"))},p.checkHit=function(){for(var t=0;t<GameData.bulletArray.length;t++){var e=GameData.bulletArray[t];if(e.isOver)return;var i=Math.abs(e.show.x-P2Tool.getEgretNum(this.body.position[0]));if(i<this.data.stand.halfWidth){e.isOver=!0,this.action("hit"),this.isAngry=!0;var a=Math.floor(Math.random()*Hero.getInstance().data.attack.powerSpace),o=Hero.getInstance().data.attack.powerBase+a;return this.blood-=o,void(a>.8*Hero.getInstance().data.attack.powerSpace?new Num("num3",P2Tool.getEgretNum(this.body.position[0]),P2Tool.getEgretY(this.body.position[1])-50,o):new Num("num2",P2Tool.getEgretNum(this.body.position[0]),P2Tool.getEgretY(this.body.position[1])-50,o))}}},p.action=function(t){this.actionType=t;var e=this.body.displays[0];this.setChildIndex(e,99),"walk"==t?(this.toward=1,Math.random()<.5&&(this.toward=-1),this.moveTime=Math.floor(Math.random()*this.data.walk.spaceTime)+this.data.walk.baseTime,this.setMoveClip("walk")):"stand"==t?(this.setMoveClip("stand"),this.standTime=Math.floor(Math.random()*this.data.stand.spaceTime)+this.data.stand.baseTime):"hit"!=t||this.isMissing?"attack"==t?(this.isMissing=!0,this.setMoveClip("attack")):"die"==t&&(this.isDie=!0,this.setMoveClip("die"),Hero.getInstance().exp+=this.data.exp,Hero.getInstance().exp>=Hero.getInstance().expMax&&(Hero.getInstance().exp-=Hero.getInstance().expMax,Hero.getInstance().action("levelUp"))):(this.isSkill=!1,this.hitCD=this.data.hit.CD,this.setMoveClip("hit"))},p.mcOver=function(){if("attack"==this.mcType){this.isMissing=!1;var t=(P2Tool.getEgretNum(this.body.position[0])-P2Tool.getEgretNum(Hero.getInstance().body.position[0]))*this.toward;(t>this.data.attack.range||0>t)&&(this.isSkill=!1,this.action("walk"))}else if("die"==this.mcType){this.show=null,this.parent.removeChild(this),World.P2World.removeBody(this.body);var e=Math.floor(Math.random()*this.data.die.items.length);GameData.itemArray.push(new Item(this.data.die.items[e],P2Tool.getEgretNum(this.body.position[0]),P2Tool.getEgretY(this.body.position[1])))}},p.setMoveClip=function(t){var e=this;this.mcType=t,this.offsetX=this.data[t].offsetX,this.offsetY=this.data[t].offsetY,null!=this.show&&null!=this.show.parent&&this.removeChild(this.show),this.show=Tool.addMoveClip(this,this.data.name,t,0,0,1,-1,!0),this.show.x=P2Tool.getEgretNum(this.body.position[0])+this.offsetX*this.toward,this.show.y=P2Tool.getEgretY(this.body.position[1])+this.offsetY,this.show.scaleX=this.toward,this.show.addEventListener(egret.Event.LOOP_COMPLETE,this.mcOver,this),"attack"==this.mcType&&this.show.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@attackTure"==t.frameLabel&&(e.isSkill=!0)},this)},e}(egret.DisplayObjectContainer);egret.registerClass(Enemy,"Enemy");var getEnemy=function(t){return"1"==t?enemy1:void 0},enemy1={name:"enemy1",blood:500,exp:50,stand:{offsetX:-15,offsetY:-25,halfWidth:65,halfHeight:100,powerBase:5,powerSpace:2,baseTime:200,spaceTime:200},walk:{offsetX:-15,offsetY:-25,speed:1,baseTime:200,spaceTime:200},attack:{offsetX:-85,offsetY:-50,powerBase:10,powerSpace:5,range:200},hit:{offsetX:-15,offsetY:-35,CD:50},die:{offsetX:-30,offsetY:-35,items:["thing1"]}},GameData=function(){function t(){}var e=(__define,t);return p=e.prototype,t.reset=function(){},t.loadData=function(){Tool.checkLocal("MapState")&&(t.MapState=JSON.parse(Tool.getLocal("MapState")))},t.saveData=function(){Tool.setLocal("MapState",JSON.stringify(t.MapState))},t.gameWidth=800,t.gameHeight=480,t.scaleSmall=1,t.bodyWidth=25,t.mapIndex=-1,t.difficulty=0,t.itemArray=[],t.enemyArray=[],t.bulletArray=[],t.goldNum=500,t.skillNum=50,t.bodyNum=50,t.heroIndex=1,t.MapState=[{name:"map0",state:1,item:[""]},{name:"map1",state:0,item:[""]},{name:"map2",state:0,item:[""]},{name:"map3",state:0,item:[""]},{name:"map4",state:0,item:[""]},{name:"map5",state:0,item:[""]},{name:"map6",state:0,item:[""]},{name:"map7",state:0,item:[""]},{name:"map8",state:0,item:[""]},{name:"map9",state:0,item:[""]}],t}();egret.registerClass(GameData,"GameData");var Hero=function(t){function e(i){if(t.call(this),this.bloodMax=1,this.blood=1,this.powerMax=1,this.power=1,this.expMax=1,this.exp=1,this.level=1,this.offsetX=0,this.offsetY=0,this.toward=1,this.attackCD=0,this.hitCD=0,this.moveSpeed=8,this.jumpPower=5,this._name="1",this.jumpState="",this.actionType="",this.mcType="",this.isDie=!1,this.isLevelUp=!1,this.isWalking=!1,this.isHitting=!1,this.isMissing=!1,this.isAttack=!1,null!=e.instance)throw new Error("Hero had been Instanced");e.instance=this,this.init(i)}__extends(e,t);var i=(__define,e);return p=i.prototype,e.getInstance=function(){return null==e.instance&&(e.instance=new e(GameData.heroIndex)),e.instance},p.init=function(t){this._name=t,this.data=getHero(this._name),this.bloodMax=this.data.blood,this.blood=this.data.blood,this.powerMax=this.data.power,this.power=this.data.power,this.expMax=this.data.exp,this.exp=0,this.show=Tool.addMoveClip(this,this.data.name,"stand",0,0,1,-1,!0),this.body=P2Tool.createBox(this,World.P2World,200,50,GameData.bodyWidth,GameData.bodyWidth,"testColor_png",!1),this.body.shapes[0].collisionGroup=2,this.body.shapes[0].collisionMask=1,this.action("stand")},p.syncFun=function(){this.blood<0&&!this.isDie&&this.action("die"),this.checkHit(),P2Tool.syncDisplay(this.body);var t=P2Tool.getEgretNum(this.body.position[0]),e=P2Tool.getEgretY(this.body.position[1]);this.show.x=t+this.offsetX*this.toward,this.show.y=e+this.offsetY,this.body.position[0]<P2Tool.getP2Num(25)&&(this.body.position[0]=P2Tool.getP2Num(25)),this.body.position[0]>P2Tool.getP2Num(UIManage.target.tureWidth-25)&&(this.body.position[0]=P2Tool.getP2Num(UIManage.target.tureWidth-25)),1==this.isWalking&&(this.body.position[0]-=P2Tool.getP2Num(this.moveSpeed)*this.toward),this.isLevelUp&&(this.show2.y=P2Tool.getEgretY(this.body.position[1])+this.data.levelUp.offsetY,this.show2.x=P2Tool.getEgretNum(this.body.position[0])+this.data.levelUp.offsetX);var i=UIManage.target;t>GameData.gameWidth/2&&t<i.measuredWidth-GameData.gameWidth/2&&(i.x=GameData.gameWidth/2-t),this.body.velocity[1]<0&&"up"==this.jumpState&&(this.jumpState="down"),this.body.velocity[1]>0&&"down"==this.jumpState&&(this.isWalking?this.setMoveClip("walk"):this.action("stand"),this.jumpState="empty"),this.isMissing&&(this.hitCD--,this.hitCD<0&&1==this.isHitting&&(this.isHitting=!1,this.action("stand")),this.hitCD<-80&&(this.isMissing=!1)),this.isAttack&&(this.attackCD--,this.attackCD<0&&(this.attackCD=this.data.attack.CD,GameData.bulletArray.push(new Bullet("1",this.data.attack.speed,this.toward,P2Tool.getEgretNum(this.body.position[0])-GameData.bodyWidth*this.toward,P2Tool.getEgretY(this.body.position[1])-GameData.bodyWidth/2))))},p.checkHit=function(){for(var t=0;t<GameData.itemArray.length;t++){var e=GameData.itemArray[t];Math.abs(P2Tool.getEgretNum(this.body.position[0])-e.show.x)<e.range&&e.pickUp()}if(!this.isMissing&&!this.isDie)for(var t=0;t<GameData.enemyArray.length;t++){var i=GameData.enemyArray[t];if(i.isDie)return;if(0==i.isSkill){var a=Math.abs(i.show.x-P2Tool.getEgretNum(this.body.position[0]));if(a<i.data.stand.halfWidth){this.action("hit");var o=i.data.stand.powerBase+Math.floor(Math.random()*i.data.stand.powerSpace);return this.blood-=o,void new Num("num1",P2Tool.getEgretNum(this.body.position[0]),P2Tool.getEgretY(this.body.position[1])-50,o)}}else{var a=(P2Tool.getEgretNum(i.body.position[0])-P2Tool.getEgretNum(this.body.position[0]))*i.toward;if(a<i.data.attack.range&&a>0){this.action("hit");var o=i.data.attack.powerBase+Math.floor(Math.random()*i.data.attack.powerSpace);return this.blood-=o,void new Num("num1",P2Tool.getEgretNum(this.body.position[0]),P2Tool.getEgretY(this.body.position[1])-50,o)}}}},p.action=function(t){this.actionType==t||this.isHitting||this.isDie||(this.actionType=t,"RightDown"==t||"LeftDown"==t?(this.toward=1,this.isAttack=!1,this.isWalking=!0,"RightDown"==t&&(this.toward=-1),this.setMoveClip("walk")):"AttackDown"==t?(this.attackCD=0,this.isAttack=!0,this.isWalking=!1,this.setMoveClip("attack")):"SkillDown"==t?this.setMoveClip("skill"):"JumpDown"==t?(this.setMoveClip("jump"),this.jumpState="up",this.body.velocity[1]=this.jumpPower):"hit"==t?(this.setMoveClip("hit"),this.isHitting=!0,this.isMissing=!0,this.isWalking=!1,this.hitCD=this.data.hit.CD,this.body.velocity[0]+=this.data.hit.hitMove*this.toward,this.body.velocity[1]+=this.data.hit.hitMove):"die"==t?(this.isDie=!0,this.isHitting=!1,this.isWalking=!1,this.setMoveClip("die")):"stand"==t?(this.setMoveClip("stand"),this.isAttack=!1,this.isWalking=!1):"levelUp"==t&&(this.isLevelUp=!0,this.level++,this.power=this.powerMax,this.blood=this.bloodMax,this.expMax+=this.data.expSpace,this.show2=Tool.addMoveClip(this,"hero_levelUp","hero_levelUp",0,0,1,1,!0),this.show2.y=P2Tool.getEgretY(this.body.position[1])+this.data.levelUp.offsetY,this.show2.x=P2Tool.getEgretNum(this.body.position[0])+this.data.levelUp.offsetX,this.show2.addEventListener(egret.Event.COMPLETE,function(){this.removeChild(this.show2),this.isLevelUp=!1,this.show2=null},this)),"UpDown"==t&&this.show.x>1840&&this.show.x<1945&&(console.log("UpDown"),UIManage.getInstance().hideWelcome(),UIManage.getInstance().showMap()))},p.mcOver=function(){"die"==this.mcType&&World.P2World.removeBody(this.body)},p.setMoveClip=function(t){this.mcType=t,this.offsetX=this.data[t].offsetX,this.offsetY=this.data[t].offsetY,null!=this.show&&null!=this.show.parent&&this.removeChild(this.show),this.show=Tool.addMoveClip(this,this.data.name,t,0,0,1,-1,!0),this.show.x=P2Tool.getEgretNum(this.body.position[0])+this.offsetX*this.toward,this.show.y=P2Tool.getEgretY(this.body.position[1])+this.offsetY,this.show.addEventListener(egret.Event.LOOP_COMPLETE,this.mcOver,this),this.show.scaleX=this.toward},e}(egret.DisplayObjectContainer);egret.registerClass(Hero,"Hero");var getHero=function(t){return"1"==t?hero1:void 0},hero1={name:"hero1",blood:500,power:200,exp:155,expSpace:200,stand:{offsetX:-10,offsetY:-17.5},walk:{offsetX:5,offsetY:-22,moveSpeed:1.5},jump:{offsetX:10,offsetY:-17.5},attack:{offsetX:-12,offsetY:-17.5,powerBase:50,powerSpace:20,speed:20,CD:10},skill:{offsetX:-2,offsetY:-22.5,powerBase:50,powerSpace:20},hit:{offsetX:-13,offsetY:-20,CD:50,hitMove:1},die:{offsetX:0,offsetY:-6},levelUp:{offsetX:0,offsetY:-80}},Item=function(){function t(t,e,i){this._name="1",this.isStand=!1,this.isOver=!1,this.hadPick=!1,this.originY=0,this.range=25,this.missTime=500,this._name=t,this.data=getItem(this._name),this.originY=i,this.show=Tool.addBitmap(UIManage.target.item,"item_"+this.data.name+"_png",e,i,GameData.bodyWidth,GameData.bodyWidth,!1),this.show.anchorOffsetX=this.show.width/2,this.show.anchorOffsetY=this.show.height/2,this.show.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.drop()}var e=(__define,t);return p=e.prototype,p.drop=function(){var t=egret.Tween.get(this.show);t.to({y:this.originY-60,rotation:1080},300,egret.Ease.sineIn).call(function(){var t=egret.Tween.get(this.show);t.to({y:this.originY+10,rotation:720},300).call(this.stand,this)},this)},p.stand=function(){this.isStand=!0;var t=egret.Tween.get(this.show);t.to({y:this.originY},800).call(function(){var t=egret.Tween.get(this.show);t.to({y:this.originY+10},800).call(this.stand,this)},this)},p.pickUp=function(){if(!this.hadPick&&this.isStand){this.hadPick=!0,egret.Tween.removeTweens(this.show);var t=P2Tool.getEgretNum(Hero.getInstance().body.position[0]),e=P2Tool.getEgretY(Hero.getInstance().body.position[1])-30,i=egret.Tween.get(this.show);i.to({x:t,y:e,alpha:0,scaleX:.5,scaleY:.5},400,egret.Ease.backIn).call(this.onRemove,this)}},p.syncFun=function(){if(!this.isOver&&(this.missTime--,this.missTime<0)){var t=egret.Tween.get(this.show);t.to({alpha:0},500).call(this.onRemove,this)}},p.onRemove=function(t){this.isOver=!0,this.show.visible=!1,egret.Tween.removeTweens(this.show),this.show.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},t}();egret.registerClass(Item,"Item");var getItem=function(t){return"thing1"==t?thing1:void 0},thing1={name:"thing1"},Num=function(){function t(t,e,i,a,o){void 0===o&&(o=!1),a>0?this.show=Tool.addBitmapText(UIManage.target,t+"_fnt",e,i,.8,a+""):this.show=Tool.addBitmapText(UIManage.target,t+"_fnt",e,i,.8,"m"),this.show.anchorOffsetX+=this.show.measuredWidth/2,this.show.anchorOffsetY+=this.show.measuredHeight/2;var s=egret.Tween.get(this.show);if(s.to({alpha:.5,y:this.show.y-100},800).call(function(){this.show.parent.removeChild(this.show),this.show=null},this),o||"num3"==t){this.tip=Tool.addBitmap(UIManage.target,"num_title_png",0,0,0,0,!1),this.tip.x=this.show.x-this.show.width/2-this.tip.width/3,this.tip.y=this.show.y-this.show.height/2-this.tip.height/2,this.show.parent.setChildIndex(this.show,99);var n=egret.Tween.get(this.tip);n.to({alpha:.5,y:this.tip.y-100},800).call(function(){this.tip.parent.removeChild(this.tip),this.tip=null},this)}}var e=(__define,t);return p=e.prototype,p.onRemove=function(t){t.target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},t}();egret.registerClass(Num,"Num");var Main=function(t){function e(){t.call(this),this.hadLoad=0,this.resList=["worldMap","map","hero","enemy","attack","other","num","item","ctrl"],this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(this.resList[0])},p.onResourceLoadComplete=function(t){this.hadLoad++,this.hadLoad==this.resList.length?(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),GameData.loadData(),GameData.reset(),this.stage.addChild(new World),UIManage.getInstance().showWelcome()):RES.loadGroup(this.resList[this.hadLoad])},p.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},p.onResourceProgress=function(t){},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var P2Tool=function(){function t(){}var e=(__define,t);return p=e.prototype,t.initSpace=function(t,e){this.factor=t,this.worldShape=e},t.clearWorld=function(t){if(null!=t){for(var e=0;e<t.bodies.length;e++)t.removeBody(t.bodies[0]);t.clear()}},t.createBox=function(e,i,a,o,s,n,h,l){var r=new p2.Body({mass:1,position:t.getP2Pos(a,o)}),d=new p2.Box({width:t.getP2Num(s),height:t.getP2Num(n)});if(""!=h){var p=Tool.addBitmap(e,h,a,o,s,n,!1);p.anchorOffsetX=p.width/2,p.anchorOffsetY=p.height/2,r.displays=[p]}return r.updateMassProperties(),r.addShape(d),l&&(d.material=new p2.Material),i.addBody(r),t.syncDisplay(r),r},t.createCircle=function(e,i,a,o,s,n,h){var l=new p2.Body({mass:1,position:t.getP2Pos(a,o)}),r=new p2.Circle({radius:t.getP2Num(s)});if(""!=n){var d=Tool.addBitmap(e,n,a,o,2*s,2*s,!1);d.anchorOffsetX=d.width/2,d.anchorOffsetY=d.height/2,l.displays=[d]}return l.addShape(r),h&&(r.material=new p2.Material),i.addBody(l),t.syncDisplay(l),l},t.createPlane=function(e,i,a,o){var s=new p2.Body,n=new p2.Plane;return s.addShape(n),s.type=p2.Body.STATIC,s.position[0]=t.getP2Num(i),s.position[1]=t.getP2Num(a),s.angle=Tool.getRadian(o),console.log("angle   "+Tool.getRadian(o)),e.addBody(s),s},t.setAngle=function(e,i){var a=3.14*(0-i)/180;1==e.fixedRotation?(e.fixedRotation=!1,e.angle=a,e.fixedRotation=!0):e.angle=a,t.syncDisplay(e)},t.syncDisplay=function(e){if(null!=e.displays){var i=e.displays[0],a=t.getEgretPos(e);i.x=a[0],i.y=a[1],i.rotation=360-180*e.angle/Math.PI}},t.getEgretNum=function(t){return t*this.factor},t.getP2Num=function(t){return t/this.factor},t.getP2Y=function(t){return(this.worldShape.height-t)/this.factor},t.getEgretY=function(t){return this.worldShape.height-t*this.factor},t.getP2Pos=function(t,e){var i=[t/this.factor,(this.worldShape.height-e)/this.factor];return i},t.getEgretPos=function(t){var e=t.position[0],i=t.position[1];return[e*this.factor,this.worldShape.height-i*this.factor]},t.getDistance=function(e,i){return Math.sqrt(Math.pow(t.getEgretNum(e.position[0])-t.getEgretNum(i.position[0]),2)+Math.pow(t.getEgretNum(e.position[1])-t.getEgretNum(i.position[1]),2))},t}();egret.registerClass(P2Tool,"P2Tool");var CtrlScene=function(t){function e(){if(t.call(this),this.showing="empty",this.isTip=!1,this.isTop=!1,this.isCtrl=!1,this.abilityIndex=0,this.abilityIsDetail=!1,this.drupShopDrupNum=1,this.drupShopIndex=0,this.drupShopIsDetail=!1,this.weaponShopIndex=0,this.weaponShopIsDetail=!1,null!=e.instance)throw new Error("CtrlScene had been Instanced");e.instance=this,World.instance.addChild(this),this.width=GameData.gameWidth,this.height=GameData.gameHeight}__extends(e,t);var i=(__define,e);return p=i.prototype,e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},p.removeAll=function(){this.removeChildren(),this.topBackgorund=null,this.bloodBar=null,this.powerBar=null,this.expBar=null,this.level=null,this.map=null},p.showTop=function(){this.isTop=!0,this.topBackgorund=Tool.addBitmap(this,"ctrl_topBackground_png",0,0,this.width,80),Tool.addBitmap(this,"ctrl_barBackground_png",195,30,130,40),Tool.addBitmap(this,"ctrl_barBackground_png",345,30,130,40),Tool.addBitmap(this,"ctrl_barBackground_png",495,30,130,40),this.bloodBar=Tool.addBitmap(this,"ctrl_bloodBar_png",200,35,120,30),this.powerBar=Tool.addBitmap(this,"ctrl_powerBar_png",350,35,120,30),this.expBar=Tool.addBitmap(this,"ctrl_expBar_png",500,35,120,30),this.bloodText=Tool.addTextField(this,200,10,0,0,15,0,"血量:"+Hero.getInstance().blood+" / "+Hero.getInstance().bloodMax),this.powerText=Tool.addTextField(this,350,10,0,0,15,0,"法力:"+Hero.getInstance().power+" / "+Hero.getInstance().powerMax),this.expText=Tool.addTextField(this,500,10,0,0,15,0,"经验:"+Hero.getInstance().exp+" / "+Hero.getInstance().expMax),this.level=Tool.addTextField(this,20,20,0,0,30,0,"LEVEL:"+Hero.getInstance().level),this.map=Tool.addTextField(this,700,20,0,0,30,0,UIManage.target._name)},p.showCtrl=function(t){void 0===t&&(t="war"),this.isCtrl=!0,this.ctrlBackgorund=Tool.addBitmap(this,"ctrl_topBackground_png",0,410,this.width,70,!1,!1),this.left=Tool.addBitmap(this,"ctrl_left_png",50,445,50,50,!0,!0),this.right=Tool.addBitmap(this,"ctrl_right_png",120,445,50,50,!0,!0),this.attack=Tool.addBitmap(this,"ctrl_attack_png",680,445,50,50,!0,!0),this.jump=Tool.addBitmap(this,"ctrl_jump_png",750,445,50,50,!0,!0),"war"==t?(this.blood=Tool.addBitmap(this,"ctrl_blood_png",190,445,50,50,!0,!0),this.power=Tool.addBitmap(this,"ctrl_power_png",260,445,50,50,!0,!0),this.skill1=Tool.addBitmap(this,"ctrl_skill1_png",540,445,50,50,!0,!0),this.skill2=Tool.addBitmap(this,"ctrl_skill2_png",610,445,50,50,!0,!0)):"welcome"==t&&(this.level=Tool.addTextField(this,250,425,0,0,30,0,"LEVEL:"+Hero.getInstance().level),this.expText=Tool.addTextField(this,460,415,0,0,15,0,"经验:"+Hero.getInstance().exp+" / "+Hero.getInstance().expMax),this.expBar=Tool.addBitmap(this,"ctrl_expBar_png",460,440,120,30),Tool.addBitmap(this,"ctrl_barBackground_png",455,435,130,40))},p.showTip=function(t){if(!this.isTip){null==this.tipInfo&&(this.tipInfo=Tool.addTextField(this,200,240,400,30,30,16711680,"提示信息")),this.setChildIndex(this.tipInfo,99),this.isTip=!0,this.tipInfo.y=200,this.tipInfo.alpha=1.2,this.tipInfo.text=t;var e=egret.Tween.get(this.tipInfo);e.to({y:this.tipInfo.y-150,alpha:.3},800).call(function(){this.tipInfo.alpha=0,this.isTip=!1},this)}},p.ctrlDrupShop=function(t,e){if(void 0===e&&(e=1),"show"==t){if("empty"!=this.showing)return;this.drupShopData=drupShop,this.showing="drupShop",this.drupShopItems=[],this.drupShopIcon=[],this.drupShopName=[],this.drupShopInfo=[],this.drupShopCost=[],this.drupShopContainer=new egret.DisplayObjectContainer,this.drupShopContainer.width=500,this.drupShopContainer.height=400,this.drupShopContainer.anchorOffsetX=this.drupShopContainer.width/2,this.drupShopContainer.anchorOffsetY=this.drupShopContainer.height/2,this.drupShopContainer.x=this.width/2,this.drupShopContainer.y=210,this.drupShopBackground=Tool.addBitmap(this.drupShopContainer,"drupShop_background_png",0,0,500,400),this.drupShopBackground.touchEnabled=!0,this.drupShopBackground.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.localX>205&&t.localX<250&&t.localY>345&&t.localY<390&&this.ctrlDrupShop("hide")},this),this.drupShopItemGroup=new eui.Group,this.drupShopItemGroup.touchEnabled=!0,this.drupShopItemGroup.width=370,this.drupShopItemGroup.height=70*this.drupShopData.items.length,this.drupShopItemGroup.cacheAsBitmap=!0;for(var i=0;i<this.drupShopData.items.length;i++)this.drupShopItems.push(Tool.addBitmap(this.drupShopItemGroup,"drupShop_item_png",0,70*i,370,65)),this.drupShopIcon.push(Tool.addBitmap(this.drupShopItemGroup,this.drupShopData.items[i].icon,17,70*i+10,40,40)),this.drupShopName.push(Tool.addTextField(this.drupShopItemGroup,80,70*i+8,0,0,20,0,this.drupShopData.items[i].name)),this.drupShopCost.push(Tool.addTextField(this.drupShopItemGroup,290,70*i+10,0,0,18,0,this.drupShopData.items[i].cost)),this.drupShopInfo.push(Tool.addTextField(this.drupShopItemGroup,80,70*i+38,0,0,15,0,this.drupShopData.items[i].info)),this.drupShopName[i].textAlign=egret.HorizontalAlign.LEFT,this.drupShopInfo[i].textAlign=egret.HorizontalAlign.LEFT,this.drupShopIcon[i].touchEnabled=!0,this.drupShopIcon[i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){for(var e=0;e<this.drupShopIcon.length;e++)if(t.target==this.drupShopIcon[e])return this.drupShopIndex=e,void this.ctrlDrupShop("showDetail")},this);var a=new eui.Group,o=new eui.Scroller;o.x=47,o.y=105,o.width=370,o.height=210,o.viewport=a,o.touchEnabled=!0,this.drupShopContainer.addChild(o),a.addChild(this.drupShopItemGroup),this.addChild(this.drupShopContainer),this.drupShopContainer.scaleX=0,this.drupShopContainer.scaleY=0;var s=egret.Tween.get(this.drupShopContainer);s.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hide"==t){if("empty"==this.showing)return;var s=egret.Tween.get(this.drupShopContainer);s.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.removeChild(this.drupShopContainer),this.drupShopDetailContainer=null,this.drupShopDrupNumText=null,this.drupShopBackground=null,this.drupShopContainer=null,this.drupShopItemGroup=null,this.drupShopIsDetail=null,this.drupShopDrupNum=null,this.drupShopIndex=null,this.drupShopItems=null,this.drupShopIcon=null,this.drupShopName=null,this.drupShopInfo=null,this.drupShopCost=null,this.drupShopData=null,this.drupShopSum=null,this.showing="empty"},this)}else if("showDetail"==t){this.drupShopDrupNum=1,this.drupShopIsDetail=!0,this.drupShopDetailContainer=new egret.DisplayObjectContainer,this.drupShopDetailContainer.width=300,this.drupShopDetailContainer.height=180,this.drupShopDetailContainer.anchorOffsetX=150,this.drupShopDetailContainer.anchorOffsetY=90,this.drupShopDetailContainer.x=this.drupShopContainer.width/2,this.drupShopDetailContainer.y=this.drupShopContainer.height/2,this.drupShopContainer.addChild(this.drupShopDetailContainer);var n=Tool.addBitmap(this.drupShopDetailContainer,"drupShop_detail_png",0,0,300,180),h=(Tool.addBitmap(this.drupShopDetailContainer,this.drupShopData.items[this.drupShopIndex].icon,27,33,50,50),Tool.addTextField(this.drupShopDetailContainer,12,98,80,20,16,16777215,this.drupShopData.items[this.drupShopIndex].name),Tool.addTextField(this.drupShopDetailContainer,90,25,90,90,15,16777215,this.drupShopData.items[this.drupShopIndex].info)),l=Tool.addTextField(this.drupShopDetailContainer,190,70,60,15,15,16777215,"单价:"+this.drupShopData.items[this.drupShopIndex].cost);this.drupShopSum=Tool.addTextField(this.drupShopDetailContainer,190,95,100,15,15,16777215,"总额:"+this.drupShopData.items[this.drupShopIndex].cost),this.drupShopDrupNumText=new eui.EditableText,this.drupShopDrupNumText.x=215,this.drupShopDrupNumText.y=40,this.drupShopDrupNumText.width=40,this.drupShopDrupNumText.size=15,this.drupShopDrupNumText.height=15,this.drupShopDrupNumText.textColor=16777215,this.drupShopDrupNumText.textAlign=egret.HorizontalAlign.CENTER,this.drupShopDrupNumText.text="01",this.drupShopDetailContainer.addChild(this.drupShopDrupNumText),this.drupShopDrupNumText.addEventListener(egret.Event.FOCUS_OUT,function(){var t=parseInt(this.drupShopDrupNumText.text);console.log("temp  "+t),this.ctrlDrupShop("update",t)},this),l.textAlign=egret.HorizontalAlign.LEFT,h.textAlign=egret.HorizontalAlign.LEFT,this.drupShopSum.textAlign=egret.HorizontalAlign.LEFT,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){console.log("x   "+t.localX,"   y   "+t.localY),t.localX>188&&t.localX<203&&t.localY>40&&t.localY<58?this.ctrlDrupShop("update",--this.drupShopDrupNum):t.localX>267&&t.localX<283&&t.localY>40&&t.localY<58?this.ctrlDrupShop("update",++this.drupShopDrupNum):t.localX>40&&t.localX<135&&t.localY>105&&t.localY<165?16711680==this.drupShopSum.textColor?this.showTip("金币不足"):(this.showTip("购买成功"),this.ctrlDrupShop("hideDetail")):t.localX>190&&t.localX<260&&t.localY>135&&t.localY<165&&this.ctrlDrupShop("hideDetail")},this),this.drupShopDetailContainer.scaleX=0,this.drupShopDetailContainer.scaleY=0;var s=egret.Tween.get(this.drupShopDetailContainer);s.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hideDetail"==t){if(!this.drupShopIsDetail)return;this.drupShopIsDetail=!1;var s=egret.Tween.get(this.drupShopDetailContainer);s.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.drupShopContainer.removeChild(this.drupShopDetailContainer),this.drupShopDetailContainer=null,this.drupShopDrupNumText=null,this.drupShopSum=null,this.showing="drupShop"
},this)}else if("update"==t){console.log("update"+e),this.drupShopDrupNum=e,this.drupShopDrupNum<1?this.drupShopDrupNum=1:this.drupShopDrupNum>99&&(this.drupShopDrupNum=99),this.drupShopDrupNumText.text=Tool.setZero(this.drupShopDrupNum,2);var r=this.drupShopData.items[this.drupShopIndex].cost*this.drupShopDrupNum;this.drupShopSum.text="总额:"+r,r<GameData.goldNum?this.drupShopSum.textColor=16777215:this.drupShopSum.textColor=16711680}},p.ctrlWeaponShop=function(t,e){if(void 0===e&&(e=1),"show"==t){if("empty"!=this.showing)return;this.weaponShopData=weaponShop,this.showing="weaponShop",this.weaponShopItems=[],this.weaponShopIcon=[],this.weaponShopName=[],this.weaponShopInfo=[],this.weaponShopCost=[],this.weaponShopContainer=new egret.DisplayObjectContainer,this.weaponShopContainer.width=500,this.weaponShopContainer.height=400,this.weaponShopContainer.anchorOffsetX=this.weaponShopContainer.width/2,this.weaponShopContainer.anchorOffsetY=this.weaponShopContainer.height/2,this.weaponShopContainer.x=this.width/2,this.weaponShopContainer.y=210,this.weaponShopBackground=Tool.addBitmap(this.weaponShopContainer,"weaponShop_background_png",0,0,550,400),this.weaponShopBackground.touchEnabled=!0,this.weaponShopBackground.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.localX>200&&t.localX<260&&t.localY>345&&t.localY<385&&this.ctrlWeaponShop("hide")},this),this.weaponShopItemGroup=new eui.Group,this.weaponShopItemGroup.touchEnabled=!0,this.weaponShopItemGroup.width=370,this.weaponShopItemGroup.height=70*this.weaponShopData.items.length,this.weaponShopItemGroup.cacheAsBitmap=!0;for(var i=0;i<this.weaponShopData.items.length;i++)this.weaponShopItems.push(Tool.addBitmap(this.weaponShopItemGroup,"weaponShop_item_png",0,70*i,370,65)),this.weaponShopIcon.push(Tool.addBitmap(this.weaponShopItemGroup,this.weaponShopData.items[i].icon,17,70*i+10,40,40)),this.weaponShopName.push(Tool.addTextField(this.weaponShopItemGroup,80,70*i+8,0,0,20,0,this.weaponShopData.items[i].name)),this.weaponShopCost.push(Tool.addTextField(this.weaponShopItemGroup,290,70*i+10,0,0,18,0,this.weaponShopData.items[i].cost)),this.weaponShopInfo.push(Tool.addTextField(this.weaponShopItemGroup,80,70*i+38,0,0,15,0,this.weaponShopData.items[i].info)),this.weaponShopName[i].textAlign=egret.HorizontalAlign.LEFT,this.weaponShopInfo[i].textAlign=egret.HorizontalAlign.LEFT,this.weaponShopIcon[i].touchEnabled=!0,this.weaponShopIcon[i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){for(var e=0;e<this.weaponShopIcon.length;e++)if(t.target==this.weaponShopIcon[e])return this.weaponShopIndex=e,void this.ctrlWeaponShop("showDetail")},this);var a=new eui.Group,o=new eui.Scroller;o.x=47,o.y=105,o.width=370,o.height=210,o.viewport=a,o.touchEnabled=!0,this.weaponShopContainer.addChild(o),a.addChild(this.weaponShopItemGroup),this.addChild(this.weaponShopContainer),this.weaponShopContainer.scaleX=0,this.weaponShopContainer.scaleY=0;var s=egret.Tween.get(this.weaponShopContainer);s.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hide"==t){if("empty"==this.showing)return;var s=egret.Tween.get(this.weaponShopContainer);s.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.removeChild(this.weaponShopContainer),this.weaponShopDetailContainer=null,this.weaponShopweaponNumText=null,this.weaponShopBackground=null,this.weaponShopContainer=null,this.weaponShopItemGroup=null,this.weaponShopIsDetail=null,this.weaponShopweaponNum=null,this.weaponShopIndex=null,this.weaponShopItems=null,this.weaponShopIcon=null,this.weaponShopName=null,this.weaponShopInfo=null,this.weaponShopCost=null,this.weaponShopData=null,this.weaponShopSum=null,this.showing="empty"},this)}else if("showDetail"==t){this.weaponShopIsDetail=!0,this.weaponShopDetailContainer=new egret.DisplayObjectContainer,this.weaponShopDetailContainer.width=300,this.weaponShopDetailContainer.height=180,this.weaponShopDetailContainer.anchorOffsetX=150,this.weaponShopDetailContainer.anchorOffsetY=90,this.weaponShopDetailContainer.x=this.weaponShopContainer.width/2,this.weaponShopDetailContainer.y=this.weaponShopContainer.height/2,this.weaponShopContainer.addChild(this.weaponShopDetailContainer);var n=Tool.addBitmap(this.weaponShopDetailContainer,"weaponShop_detail_png",0,0,300,180),h=(Tool.addBitmap(this.weaponShopDetailContainer,this.weaponShopData.items[this.weaponShopIndex].icon,27,33,50,50),Tool.addTextField(this.weaponShopDetailContainer,12,98,80,20,16,16777215,this.weaponShopData.items[this.weaponShopIndex].name),Tool.addTextField(this.weaponShopDetailContainer,90,50,195,70,15,16777215,this.weaponShopData.items[this.weaponShopIndex].info)),l=Tool.addTextField(this.weaponShopDetailContainer,90,28,130,16,16,16777215,"售价:"+this.weaponShopData.items[this.weaponShopIndex].cost);l.textAlign=egret.HorizontalAlign.LEFT,h.textAlign=egret.HorizontalAlign.LEFT,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.localX>40&&t.localX<135&&t.localY>105&&t.localY<165?16711680==this.weaponShopSum.textColor?this.showTip("金币不足"):(this.showTip("购买成功"),this.ctrlWeaponShop("hideDetail")):t.localX>190&&t.localX<260&&t.localY>135&&t.localY<165&&this.ctrlWeaponShop("hideDetail")},this),this.weaponShopDetailContainer.scaleX=0,this.weaponShopDetailContainer.scaleY=0;var s=egret.Tween.get(this.weaponShopDetailContainer);s.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hideDetail"==t){if(!this.weaponShopIsDetail)return;this.weaponShopIsDetail=!1;var s=egret.Tween.get(this.weaponShopDetailContainer);s.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.weaponShopContainer.removeChild(this.weaponShopDetailContainer),this.weaponShopDetailContainer=null,this.weaponShopweaponNumText=null,this.weaponShopSum=null,this.showing="weaponShop"},this)}},p.ctrlAbility=function(t){if("show"==t){if("empty"!=this.showing)return;this.abilityData=ability,this.showing="ability",this.abilityIcon=[],this.abilityText=[],this.abilityContainer=new egret.DisplayObjectContainer,this.abilityContainer.width=700,this.abilityContainer.height=420,this.abilityContainer.anchorOffsetX=this.abilityContainer.width/2,this.abilityContainer.anchorOffsetY=this.abilityContainer.height/2,this.abilityContainer.x=this.width/2,this.abilityContainer.y=this.height/2,this.abilityBackground=Tool.addBitmap(this.abilityContainer,"ability_background_png",0,0,this.abilityContainer.width,this.abilityContainer.height),this.abilityBackground.touchEnabled=!0,this.abilityBackground.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(!this.abilityIsDetail){t.stageX>270&&t.stageX<425&&t.stageY>360&&t.stageY<390&&this.ctrlAbility("hide");for(var e=0;3>e;e++)for(var i=0;5>i;i++)if(this.abilityIndex=5*e+i,t.localX>158+80*i&&t.localX<217+80*i&&t.localY>120+70*e&&t.localY<180+70*e)return void this.ctrlAbility("showDetail")}},this),this.abilitySkill=Tool.addTextField(this.abilityContainer,120,60,0,0,18,16777215,"剩余技能点:"+GameData.skillNum),this.abilityBody=Tool.addTextField(this.abilityContainer,455,60,0,0,18,16777215,"剩余属性值:"+GameData.bodyNum);for(var e=0;5>e;e++)this.abilityIcon.push(Tool.addBitmap(this.abilityContainer,this.abilityData.skill1[e].icon,80*e+187,150,60,60,!1,!0)),this.abilityText.push(Tool.addTextField(this.abilityContainer,80*e+163,162,50,0,15,16711680,this.abilityData.skill1[e].level+"/"+this.abilityData.skill1[e].maxLevel)),this.abilityText[e].textAlign=egret.HorizontalAlign.RIGHT;for(var e=0;5>e;e++)this.abilityIcon.push(Tool.addBitmap(this.abilityContainer,this.abilityData.skill2[e].icon,80*e+187,220,60,60,!1,!0)),this.abilityText.push(Tool.addTextField(this.abilityContainer,80*e+163,232,50,0,15,16711680,this.abilityData.skill2[e].level+"/"+this.abilityData.skill2[e].maxLevel)),this.abilityText[e+5].textAlign=egret.HorizontalAlign.RIGHT;for(var e=0;5>e;e++)this.abilityData.data[e].state=Math.floor(this.abilityData.data[e].level/(this.abilityData.data[e].maxLevel/5))+1,this.abilityData.data[e].state>5&&(this.abilityData.data[e].state=5),this.abilityIcon.push(Tool.addBitmap(this.abilityContainer,this.abilityData.data[e].icon+this.abilityData.data[e].state+"_png",80*e+187,290,60,60,!1,!0)),this.abilityText.push(Tool.addTextField(this.abilityContainer,80*e+163,302,50,0,15,16711680,this.abilityData.data[e].level+"/"+this.abilityData.data[e].maxLevel)),this.abilityText[e+10].textAlign=egret.HorizontalAlign.RIGHT;this.addChild(this.abilityContainer),this.abilityContainer.scaleX=0,this.abilityContainer.scaleY=0;var i=egret.Tween.get(this.abilityContainer);i.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hide"==t){if("empty"==this.showing)return;var i=egret.Tween.get(this.abilityContainer);i.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.removeChild(this.abilityContainer),this.abilityDetailContainer=null,this.abilityDetailLevel=null,this.abilityBackground=null,this.abilityDetailIcon=null,this.abilityContainer=null,this.abilityIsDetail=null,this.abilitySkill=null,this.abilityIndex=null,this.abilityBody=null,this.abilityText=null,this.abilityData=null,this.abilityIcon=null,this.showing="empty"},this)}else if("showDetail"==t){this.abilityIsDetail=!0,this.abilityDetailContainer=new egret.DisplayObjectContainer,this.abilityDetailContainer.width=300,this.abilityDetailContainer.height=180,this.abilityDetailContainer.anchorOffsetX=150,this.abilityDetailContainer.anchorOffsetY=90,this.abilityDetailContainer.x=this.abilityContainer.width/2,this.abilityDetailContainer.y=this.abilityContainer.height/2,this.abilityContainer.addChild(this.abilityDetailContainer);var a=Tool.addBitmap(this.abilityDetailContainer,"ability_detail_png",0,0,300,180),o=Tool.addTextField(this.abilityDetailContainer,120,60,150,90,15,16777215,"简介");this.abilityDetailLevel=Tool.addTextField(this.abilityDetailContainer,25,130,90,20,20,16777215,"Level:"+this.abilityText[this.abilityIndex].text.substr(0,this.abilityText[this.abilityIndex].text.length-3)),this.abilityIndex<5?o.text=this.abilityData.skill1[this.abilityIndex].intruction:this.abilityIndex<10?o.text=this.abilityData.skill2[this.abilityIndex-5].intruction:this.abilityIndex<15&&(o.text=this.abilityData.data[this.abilityIndex-10].intruction),o.textAlign=egret.HorizontalAlign.LEFT,this.abilityDetailIcon=new egret.Bitmap,this.abilityDetailIcon.texture=this.abilityIcon[this.abilityIndex].texture,this.abilityDetailContainer.addChild(this.abilityDetailIcon),this.abilityDetailIcon.width=50,this.abilityDetailIcon.height=50,this.abilityDetailIcon.x=40,this.abilityDetailIcon.y=65,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.localX>40&&t.localX<85&&t.localY>85&&t.localY<110?this.ctrlAbility("levelUp"):t.localX>215&&t.localX<280&&t.localY>5&&t.localY<35&&this.ctrlAbility("hideDetail")},this),this.abilityDetailContainer.scaleX=0,this.abilityDetailContainer.scaleY=0;var i=egret.Tween.get(this.abilityDetailContainer);i.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hideDetail"==t){if(!this.abilityIsDetail)return;this.abilityIsDetail=!1;var i=egret.Tween.get(this.abilityDetailContainer);i.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.abilityContainer.removeChild(this.abilityDetailContainer),this.abilityDetailContainer=null,this.abilityDetailLevel=null,this.showing="ability"},this)}else if("levelUp"==t){if(this.abilityIndex<5)GameData.skillNum>0&&this.abilityData.skill1[this.abilityIndex].level<this.abilityData.skill1[this.abilityIndex].maxLevel&&(GameData.skillNum--,this.abilityData.skill1[this.abilityIndex].level++,this.abilityText[this.abilityIndex].text=this.abilityData.skill1[this.abilityIndex].level+"/"+this.abilityData.skill1[this.abilityIndex].maxLevel);else if(this.abilityIndex<10)GameData.skillNum>0&&this.abilityData.skill2[this.abilityIndex-5].level<this.abilityData.skill2[this.abilityIndex-5].maxLevel&&(GameData.skillNum--,this.abilityData.skill2[this.abilityIndex-5].level++,this.abilityText[this.abilityIndex].text=this.abilityData.skill2[this.abilityIndex-5].level+"/"+this.abilityData.skill2[this.abilityIndex-5].maxLevel);else if(this.abilityIndex<15){var e=this.abilityIndex-10;GameData.bodyNum>0&&this.abilityData.data[e].level<this.abilityData.data[e].maxLevel&&(GameData.bodyNum--,this.abilityData.data[e].level++,this.abilityData.data[e].state=Math.floor(this.abilityData.data[e].level/(this.abilityData.data[e].maxLevel/5))+1,this.abilityData.data[e].state>5&&(this.abilityData.data[e].state=5),this.abilityIcon[this.abilityIndex].texture=RES.getRes(this.abilityData.data[e].icon+this.abilityData.data[e].state+"_png"),this.abilityDetailIcon.texture=RES.getRes(this.abilityData.data[e].icon+this.abilityData.data[e].state+"_png"),this.abilityText[this.abilityIndex].text=this.abilityData.data[e].level+"/"+this.abilityData.data[e].maxLevel)}this.abilityDetailLevel.text="Level:"+this.abilityText[this.abilityIndex].text.substr(0,this.abilityText[this.abilityIndex].text.length-3),this.abilityBody.text="剩余属性值:"+GameData.bodyNum,this.abilitySkill.text="剩余技能点:"+GameData.skillNum}},p.ctrlAhievement=function(t){if("show"==t){if("empty"!=this.showing)return;this.achievementData=achievement,this.showing="achievement",this.achievementBtn=[],this.achievementGift=[],this.achievementIcon=[],this.achievementItems=[],this.achievementDetail=[],this.achievementContainer=new egret.DisplayObjectContainer,this.achievementContainer.width=500,this.achievementContainer.height=350,this.achievementContainer.anchorOffsetX=this.achievementContainer.width/2,this.achievementContainer.anchorOffsetY=this.achievementContainer.height/2,this.achievementContainer.x=this.width/2,this.achievementContainer.y=this.height/2,this.achievementBackground=Tool.addBitmap(this.achievementContainer,"achievement_background_png",this.achievementContainer.width/2,this.achievementContainer.height/2,500,350,!1,!0),this.achievementBackground.touchEnabled=!0,this.achievementBackground.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stageX>600&&t.stageX<630&&t.stageY>75&&t.stageY<100&&this.ctrlAhievement("hide")},this),this.achievementItemGroup=new eui.Group,this.achievementItemGroup.touchEnabled=!0,this.achievementItemGroup.width=470,this.achievementItemGroup.height=85*this.achievementData.items.length,this.achievementItemGroup.cacheAsBitmap=!0;for(var e=0;e<this.achievementData.items.length;e++)this.achievementItems.push(Tool.addBitmap(this.achievementItemGroup,"achievement_item_png",2,85*e,470,80)),this.achievementBtn.push(Tool.addBitmap(this.achievementItemGroup,"achievement_get_png",355,85*e+40,100,30)),this.achievementIcon.push(Tool.addBitmap(this.achievementItemGroup,this.achievementData.items[e].icon,13,85*e+15,50,50)),this.achievementGift.push(Tool.addTextField(this.achievementItemGroup,120,85*e+42,0,0,20,0,this.achievementData.items[e].gift)),this.achievementDetail.push(Tool.addTextField(this.achievementItemGroup,80,85*e+8,0,0,20,0,this.achievementData.items[e].detail)),this.achievementGift[e].textAlign=egret.HorizontalAlign.LEFT,this.achievementDetail[e].textAlign=egret.HorizontalAlign.LEFT;var i=new eui.Group,a=new eui.Scroller;a.viewport=i,a.touchEnabled=!0,a.width=470,a.height=260,a.x=17,a.y=70,this.achievementContainer.addChild(a),i.addChild(this.achievementItemGroup),this.addChild(this.achievementContainer),this.achievementContainer.scaleX=0,this.achievementContainer.scaleY=0;var o=egret.Tween.get(this.achievementContainer);o.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hide"==t){if("empty"==this.showing)return;var o=egret.Tween.get(this.achievementContainer);o.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.removeChild(this.achievementContainer),this.achievementBackground=null,this.achievementContainer=null,this.achievementItemGroup=null,this.achievementDetail=null,this.achievementItems=null,this.achievementGift=null,this.achievementBtn=null,this.showing="empty"},this)}},p.ctrlDaily=function(t){if("show"==t){if("empty"!=this.showing)return;this.dailyData=daily,this.showing="daily",this.dailyBtn=[],this.dailyGift=[],this.dailyIcon=[],this.dailyItems=[],this.dailyDetail=[],this.dailyContainer=new egret.DisplayObjectContainer,this.dailyContainer.width=500,this.dailyContainer.height=350,this.dailyContainer.anchorOffsetX=this.dailyContainer.width/2,this.dailyContainer.anchorOffsetY=this.dailyContainer.height/2,this.dailyContainer.x=this.width/2,this.dailyContainer.y=this.height/2,this.dailyBackground=Tool.addBitmap(this.dailyContainer,"daily_background_png",this.dailyContainer.width/2,this.dailyContainer.height/2,500,350,!1,!0),this.dailyBackground.touchEnabled=!0,this.dailyBackground.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.stageX>600&&t.stageX<630&&t.stageY>75&&t.stageY<100&&this.ctrlDaily("hide")},this),this.dailyItemGroup=new eui.Group,this.dailyItemGroup.touchEnabled=!0,this.dailyItemGroup.width=470,this.dailyItemGroup.height=85*this.dailyData.items.length,this.dailyItemGroup.cacheAsBitmap=!0;for(var e=0;e<this.dailyData.items.length;e++)this.dailyItems.push(Tool.addBitmap(this.dailyItemGroup,"daily_item_png",2,85*e,470,80)),this.dailyBtn.push(Tool.addBitmap(this.dailyItemGroup,"daily_get_png",355,85*e+40,100,30)),this.dailyIcon.push(Tool.addBitmap(this.dailyItemGroup,this.dailyData.items[e].icon,13,85*e+15,50,50)),this.dailyGift.push(Tool.addTextField(this.dailyItemGroup,120,85*e+42,0,0,20,0,this.dailyData.items[e].gift)),this.dailyDetail.push(Tool.addTextField(this.dailyItemGroup,80,85*e+8,0,0,20,0,this.dailyData.items[e].detail)),this.dailyGift[e].textAlign=egret.HorizontalAlign.LEFT,this.dailyDetail[e].textAlign=egret.HorizontalAlign.LEFT;var i=new eui.Group,a=new eui.Scroller;a.viewport=i,a.touchEnabled=!0,a.width=470,a.height=260,a.x=17,a.y=70,this.dailyContainer.addChild(a),i.addChild(this.dailyItemGroup),this.addChild(this.dailyContainer),this.dailyContainer.scaleX=0,this.dailyContainer.scaleY=0;var o=egret.Tween.get(this.dailyContainer);o.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else if("hide"==t){if("empty"==this.showing)return;var o=egret.Tween.get(this.dailyContainer);o.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.removeChild(this.dailyContainer),this.dailyBackground=null,this.dailyContainer=null,this.dailyItemGroup=null,this.dailyDetail=null,this.dailyItems=null,this.dailyGift=null,this.dailyBtn=null,this.showing="empty"},this)}},p.syncFun=function(){this.isTop&&(this.bloodText.text="血量:"+Hero.getInstance().blood+" / "+Hero.getInstance().bloodMax,this.powerText.text="法力:"+Hero.getInstance().power+" / "+Hero.getInstance().powerMax,this.expText.text="经验:"+Hero.getInstance().exp+" / "+Hero.getInstance().expMax,this.bloodBar.width=Hero.getInstance().blood/Hero.getInstance().bloodMax*120,this.powerBar.width=Hero.getInstance().power/Hero.getInstance().powerMax*120,this.expBar.width=Hero.getInstance().exp/Hero.getInstance().expMax*120,this.level.text="LEVEL"+Hero.getInstance().level)},p.onTouchStart=function(t){t.stopImmediatePropagation(),this.isCtrl&&(t.target==this.left?Hero.getInstance().action("LeftDown"):t.target==this.right?Hero.getInstance().action("RightDown"):t.target==this.jump?Hero.getInstance().action("JumpDown"):t.target==this.attack?Hero.getInstance().action("AttackDown"):t.target==this.skill1?Hero.getInstance().action("SkillDown"):t.target==this.skill2&&Hero.getInstance().action("SkillDown"))},p.onTouchEnd=function(t){t.stopImmediatePropagation(),this.isCtrl&&(t.target==this.left?Hero.getInstance().action("stand"):t.target==this.right?Hero.getInstance().action("stand"):t.target==this.jump?Hero.getInstance().action("other"):t.target==this.attack?Hero.getInstance().action("stand"):t.target==this.skill1?Hero.getInstance().action("stand"):t.target==this.skill2&&Hero.getInstance().action("stand"))},p.onRemove=function(t){t.target.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e}(egret.DisplayObjectContainer);egret.registerClass(CtrlScene,"CtrlScene");var MapScene=function(t){function e(){t.call(this),this.isSelect=!1,this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){this.width=800,this.height=480,this.base=Tool.addBitmap(this,"worldMap_base_png",0,0,800,480,!0);var t=this.base.width/640,e=this.base.height/470;this.map0=Tool.addBitmap(this,"worldMap_map0_disable_png",179,85,0,0,!1),this.map1=Tool.addBitmap(this,"worldMap_map1_disable_png",183,165,0,0,!1),this.map2=Tool.addBitmap(this,"worldMap_map2_disable_png",244,234,0,0,!1),this.map3=Tool.addBitmap(this,"worldMap_map3_disable_png",288,123,0,0,!1),this.map4=Tool.addBitmap(this,"worldMap_map4_disable_png",553,4,0,0,!1),this.map5=Tool.addBitmap(this,"worldMap_map5_disable_png",573,208,0,0,!1),this.map6=Tool.addBitmap(this,"worldMap_map6_disable_png",343,321,0,0,!1),this.map7=Tool.addBitmap(this,"worldMap_map7_disable_png",292,404,0,0,!1),this.map8=Tool.addBitmap(this,"worldMap_map8_disable_png",93,223,0,0,!1),this.map9=Tool.addBitmap(this,"worldMap_map9.disable_png",9,325,0,0,!1),this.back=Tool.addBitmap(this,"worldMap_back1_png",670,430,0,0,!0);for(var i=0;10>i;i++)this["map"+i].width=Math.floor(this["map"+i].measuredWidth*t),this["map"+i].height=Math.floor(this["map"+i].measuredHeight*e),GameData.MapState[i].state>0&&(this["map"+i].texture=RES.getRes("worldMap_map"+i+"_png"),this["map"+i].visible=!1);this.select=new egret.DisplayObjectContainer,this.addChild(this.select),this.select.scaleX=0,this.select.scaleY=0,this.select.width=this.width,this.select.height=this.height,this.select.x=this.select.width/2,this.select.y=this.select.height/2,this.select.anchorOffsetX=this.select.width/2,this.select.anchorOffsetY=this.select.height/2,this.selectBox=Tool.addBitmap(this.select,"worldMap_box_png",0,0,0,0,!1),this.commonBtn=Tool.addBitmap(this.select,"worldMap_common1_png",435,180,0,0,!1),this.hardBtn=Tool.addBitmap(this.select,"worldMap_hard0_png",435,240,0,0,!1),this.ruinsBtn=Tool.addBitmap(this.select,"worldMap_ruin0_png",435,300,0,0,!1),this.selectBox.x=(this.width-this.selectBox.width)/2,this.selectBox.y=(this.height-this.selectBox.height)/2,this.commonBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),this.commonBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.commonBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.hardBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),this.hardBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.hardBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.ruinsBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),this.ruinsBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.ruinsBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},p.ctrlSelect=function(){if(0==this.isSelect){this.commonBtn.touchEnabled=!0,this.hardBtn.touchEnabled=!0,this.ruinsBtn.touchEnabled=!0,GameData.MapState[GameData.mapIndex].state>1&&(this.ruinsBtn.texture=RES.getRes("worldMap_hard1_png")),GameData.MapState[GameData.mapIndex].state>2&&(this.ruinsBtn.texture=RES.getRes("worldMap_ruin1_png")),this.isSelect=!0,this.select.visible=!0;var t=egret.Tween.get(this.select);t.to({scaleX:1,scaleY:1},500,egret.Ease.backOut)}else{GameData.mapIndex=-1,this.isSelect=!1,this.commonBtn.touchEnabled=!1,this.hardBtn.touchEnabled=!1,this.ruinsBtn.touchEnabled=!1;var t=egret.Tween.get(this.select);t.to({scaleX:0,scaleY:0},500,egret.Ease.backIn).call(function(){this.select.visible=!1,UIManage.getInstance().hideMap(),UIManage.getInstance().showShengDiScene()},this)}},p.onTouchStart=function(t){return t.stopImmediatePropagation(),this.isSelect?void(t.target==this.commonBtn?this.commonBtn.texture=RES.getRes("worldMap_common2_png"):t.target==this.hardBtn&&GameData.MapState[GameData.mapIndex].state>1?this.hardBtn.texture=RES.getRes("worldMap_hard2_png"):t.target==this.ruinsBtn&&GameData.MapState[GameData.mapIndex].state>2&&(this.ruinsBtn.texture=RES.getRes("worldMap_ruin2_png"))):(t.target==this.back&&(this.back.texture=RES.getRes("worldMap_back2_png")),205<t.stageX&&t.stageX<273&&140<t.stageY&&t.stageY<170?GameData.mapIndex=0:195<t.stageX&&t.stageX<300&&210<t.stageY&&t.stageY<235?GameData.mapIndex=1:285<t.stageX&&t.stageX<390&&315<t.stageY&&t.stageY<340?GameData.mapIndex=2:405<t.stageX&&t.stageX<505&&165<t.stageY&&t.stageY<190?GameData.mapIndex=3:650<t.stageX&&t.stageX<755&&125<t.stageY&&t.stageY<150?GameData.mapIndex=4:618<t.stageX&&t.stageX<720&&300<t.stageY&&t.stageY<325?GameData.mapIndex=5:425<t.stageX&&t.stageX<530&&385<t.stageY&&t.stageY<415?GameData.mapIndex=6:305<t.stageX&&t.stageX<410&&412<t.stageY&&t.stageY<437?GameData.mapIndex=7:180<t.stageX&&t.stageX<285&&360<t.stageY&&t.stageY<390?GameData.mapIndex=8:45<t.stageX&&t.stageX<150&&420<t.stageY&&t.stageY<445&&(GameData.mapIndex=9),void(-1!=GameData.mapIndex&&GameData.MapState[GameData.mapIndex].state>0&&(this["map"+GameData.mapIndex].visible=!0)))},p.onTouchEnd=function(t){return t.stopImmediatePropagation(),this.isSelect?(t.target==this.commonBtn?(GameData.difficulty=1,this.commonBtn.texture=RES.getRes("worldMap_common1_png")):t.target==this.hardBtn&&GameData.MapState[GameData.mapIndex].state>1?(GameData.difficulty=2,this.hardBtn.texture=RES.getRes("worldMap_hard1_png")):t.target==this.ruinsBtn&&GameData.MapState[GameData.mapIndex].state>2&&(GameData.difficulty=3,this.ruinsBtn.texture=RES.getRes("worldMap_ruin1_png")),void this.ctrlSelect()):(t.target==this.back&&(this.back.texture=RES.getRes("worldMap_back1_png"),UIManage.getInstance().hideMap(),UIManage.getInstance().showWelcome()),void(-1!=GameData.mapIndex&&GameData.MapState[GameData.mapIndex].state>0&&(this["map"+GameData.mapIndex].visible=!1,this.ctrlSelect())))},p.onRemove=function(t){t.target.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e}(egret.DisplayObjectContainer);egret.registerClass(MapScene,"MapScene");var ShengDiScene=function(t){function e(){t.call(this),this.absoluteX=0,this.absoluteY=0,this.tureWidth=0,this.tureHeight=0,this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){P2Tool.initSpace(50,new egret.Rectangle(0,0,this.width,this.height)),this.width=GameData.gameWidth,this.height=GameData.gameHeight,this._name="圣地",this.background=Tool.addBitmap(this,"map_shengdi_png",0,0,0,0,!0),this.tureWidth=this.background.width,this.tureHeight=this.background.height;var t=P2Tool.createPlane(World.P2World,0,-555,0);t.shapes[0].collisionMask=3,this.role=new egret.DisplayObjectContainer,this.item=new egret.DisplayObjectContainer,this.addChild(this.role),this.addChild(this.item),this.role.addChild(Hero.getInstance()),this.y=-180;for(var e=0;10>e;e++)GameData.enemyArray.push(new Enemy("1",e/2*400+100)),this.role.addChild(GameData.enemyArray[e])},p.syncDisplay=function(){for(var t=0;t<GameData.enemyArray.length;t++){var e=GameData.enemyArray[t];e.isDie&&(Tool.removeOne(GameData.enemyArray,t),t--)}for(var t=0;t<GameData.bulletArray.length;t++){var i=GameData.bulletArray[t];i.isOver&&(i.show.parent.removeChild(i.show),Tool.removeOne(GameData.bulletArray,t),t--)}for(var t=0;t<GameData.itemArray.length;t++){var a=GameData.itemArray[t];a.isOver&&(a.show.parent.removeChild(a.show),Tool.removeOne(GameData.itemArray,t),t--)}Hero.getInstance().syncFun(),CtrlScene.getInstance().syncFun();for(var t=0;t<GameData.enemyArray.length;t++)GameData.enemyArray[t].syncFun();for(var t=0;t<GameData.bulletArray.length;t++)GameData.bulletArray[t].syncFun();for(var t=0;t<GameData.itemArray.length;t++)GameData.itemArray[t].syncFun()},p.onTouchStart=function(t){t.stopImmediatePropagation(),console.log("onTouchStart")},p.onTouchEnd=function(t){t.stopImmediatePropagation()},p.onRemove=function(t){t.target==this?(this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)):(t.target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this))},p.control=function(t){"DownDown"==t||"LeftDown"==t||"RightDown"==t||"UpDown"==t?Hero.getInstance().action(t):"RightUp"==t||"LeftUp"==t||"UpUp"==t||"DownUp"==t||"AttackUp"==t||"SkillUp"==t||"GetUp"==t?Hero.getInstance().action("stand"):"JumpUp"==t?Hero.getInstance().action("other"):"JumpDown"==t?Hero.getInstance().action("JumpDown"):"AttackDown"==t?Hero.getInstance().action("AttackDown"):"SkillDown"==t?Hero.getInstance().action("SkillDown"):"GetDown"==t&&Hero.getInstance().action("GetDown")},e}(egret.DisplayObjectContainer);egret.registerClass(ShengDiScene,"ShengDiScene");var WelcomeScene=function(t){function e(){t.call(this),this.absoluteX=0,this.absoluteY=0,this.tureWidth=0,this.tureHeight=0,this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){P2Tool.initSpace(50,new egret.Rectangle(0,0,this.width,this.height)),this.width=GameData.gameWidth,this.height=GameData.gameHeight,this._name="欢迎页面",this.background=Tool.addBitmap(this,"map_welcome_png",0,0,0,0,!0),this.tureWidth=this.background.width,this.tureHeight=this.background.height;var t=P2Tool.createPlane(World.P2World,0,-555,0);t.shapes[0].collisionMask=3,this.showBody=[],this.addChild(Hero.getInstance()),this.y=-180},p.syncDisplay=function(){for(var t=0;t<this.showBody.length;t++)P2Tool.syncDisplay(this.showBody[t]);Hero.getInstance().syncFun()},p.onTouchStart=function(t){this.absoluteX=t.stageX-this.x,this.absoluteY=t.stageY-this.y,175<this.absoluteX&&this.absoluteX<245&&200<this.absoluteY&&this.absoluteY<280&&CtrlScene.getInstance().ctrlDaily("show"),315<this.absoluteX&&this.absoluteX<350&&190<this.absoluteY&&this.absoluteY<280&&CtrlScene.getInstance().ctrlAhievement("show"),480<this.absoluteX&&this.absoluteX<540&&135<this.absoluteY&&this.absoluteY<250&&CtrlScene.getInstance().ctrlAbility("show"),110<this.absoluteX&&this.absoluteX<175&&325<this.absoluteY&&this.absoluteY<395&&CtrlScene.getInstance().ctrlWeaponShop("show"),245<this.absoluteX&&this.absoluteX<305&&325<this.absoluteY&&this.absoluteY<395&&CtrlScene.getInstance().ctrlDrupShop("show"),165<this.absoluteX&&this.absoluteX<220&&470<this.absoluteY&&this.absoluteY<550&&console.log("select   武器升级"),5<this.absoluteX&&this.absoluteX<100&&425<this.absoluteY&&this.absoluteY<550&&console.log("select   我的储物箱")},p.onTouchEnd=function(t){},p.onRemove=function(t){t.target==this?(this.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)):(t.target.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchStart,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),t.target.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this))},p.control=function(t){"DownDown"==t||"LeftDown"==t||"RightDown"==t||"UpDown"==t?Hero.getInstance().action(t):"RightUp"==t||"LeftUp"==t||"UpUp"==t||"DownUp"==t||"AttackUp"==t||"SkillUp"==t||"GetUp"==t?Hero.getInstance().action("stand"):"JumpUp"==t?Hero.getInstance().action("other"):"JumpDown"==t&&Hero.getInstance().action("JumpDown")
},e}(egret.DisplayObjectContainer);egret.registerClass(WelcomeScene,"WelcomeScene");var Tool=function(){function t(){}var e=(__define,t);return p=e.prototype,t.logPosition=function(t){console.log("x  "+t.localX+"  y   "+t.localY)},t.deepCopy=function(e){var i={};for(var a in e)i[a]="object"==typeof e[a]?t.deepCopy(e[a]):e[a];return i},t.addMoveClip=function(t,e,i,a,o,s,n,h){void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=1),void 0===n&&(n=-1),void 0===h&&(h=!1);var l=RES.getRes(e+"_json"),r=RES.getRes(e+"_png"),d=new egret.MovieClipDataFactory(l,r),p=new egret.MovieClip(d.generateMovieClipData(i));return p.scaleX=s,p.scaleY=s,t.addChild(p),h&&(p.anchorOffsetX=p.measuredWidth/2,p.anchorOffsetY=p.measuredHeight/2),p.play(n),p},t.getDistance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.getRadian=function(t){return Math.PI*t/180},t.getAngle=function(t){return 180*t/Math.PI},t.clearTimeout=function(){for(var t=setTimeout(function(){},1),e=t-100>0?t-100:0,i=e;t>=i;i++)clearTimeout(i);console.log("clearTimer")},t.clearInterval=function(){for(var t=setInterval(function(){},1),e=t-100>0?t-100:0,i=e;t>=i;i++)clearInterval(i);console.log("clearInterval")},t.addShowScaleEffect=function(t){t.visible=!0,t.scaleX=.3,t.scaleY=.3,egret.Tween.get(t).to({scaleX:1,scaleY:1},1e3,egret.Ease.elasticOut)},t.addTouchScaleEffect=function(t,e,i){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){egret.Tween.get(t).to({scaleX:.8,scaleY:.8},50)},e),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){egret.Tween.get(t).to({scaleX:1,scaleY:1},50).call(i,e)},e),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){egret.Tween.get(t).to({scaleX:1,scaleY:1},50).call(i,e)},e)},t.addBitmap=function(t,e,i,a,o,s,n,h){void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===n&&(n=!1),void 0===h&&(h=!1);var l=new egret.Bitmap;return l.texture=RES.getRes(e),0!=o&&(l.width=Math.floor(o*GameData.scaleSmall),l.height=Math.floor(s*GameData.scaleSmall)),l.x=Math.floor(i*GameData.scaleSmall),l.y=Math.floor(a*GameData.scaleSmall),t.addChild(l),n&&(l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.onTouchStart,t),l.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.onTouchEnd,t),l.addEventListener(egret.TouchEvent.TOUCH_END,t.onTouchEnd,t),l.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemove,t)),h&&(l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2),l},t.addBitmapText=function(t,e,i,a,o,s){var n=new egret.BitmapText;return n.font=RES.getRes(e),0!=o&&(n.scaleX=o*GameData.scaleSmall,n.scaleY=o*GameData.scaleSmall),n.x=Math.floor(i*GameData.scaleSmall),n.y=Math.floor(a*GameData.scaleSmall),n.text=s,t.addChild(n),n},t.addTextField=function(t,e,i,a,o,s,n,h){var l=new egret.TextField;return l.fontFamily="Microsoft YaHei",l.x=Math.floor(e*GameData.scaleSmall),l.y=Math.floor(i*GameData.scaleSmall),0!=a&&(l.width=Math.floor(a*GameData.scaleSmall),l.height=Math.floor(o*GameData.scaleSmall)),l.textAlign=egret.HorizontalAlign.CENTER,l.textColor=n,l.bold=!0,l.size=Math.floor(s*GameData.scaleSmall),l.text=h+"",t.addChild(l),l},t.setLocal=function(t,e){localStorage.setItem(t,e)},t.getLocal=function(t){var e=localStorage.getItem(t);return e},t.checkLocal=function(t){var e=localStorage.getItem(t);return null==e||""==e?!1:!0},t.setZero=function(t,e){var i="";if(t.toString().length>e+1){for(var a=0;e>a;a++)i+="9";return i}for(var a=t.toString().length;e>a;a++)i+="0";return i+t.toString()},t.removeOne=function(t,e){if(e>=0&&e<t.length){for(var i=e;i<t.length;i++)t[i]=t[i+1];t.length=t.length-1}},t}();egret.registerClass(Tool,"Tool");var UIManage=function(){function t(){if(null!=t.instance)throw new Error("UIManage had been Instanced");t.instance=this,this.registerAndroidEvent(World.instance)}var e=(__define,t);return p=e.prototype,t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},p.clear=function(e){this.registerAndroidEvent(World.instance),null!=Hero.getInstance()&&(Hero.instance=null),World.instance.removeChild(t.target),CtrlScene.getInstance().removeAll(),P2Tool.clearWorld(World.P2World),t.target=null,e=null},p.showWelcome=function(){console.log("showWelcome"),null!=this.welcomeScene&&(this.welcomeScene=null),this.welcomeScene=new WelcomeScene,this.registerAndroidEvent(this.welcomeScene),t.target=this.welcomeScene,CtrlScene.getInstance().showCtrl("welcome"),World.instance.addChildAt(t.target,0)},p.hideWelcome=function(){null!=this.welcomeScene?(console.log("hideWelcome"),this.clear(this.welcomeScene)):console.log("welcomeScene   had   not  instance")},p.showMap=function(){console.log("showMap"),null!=this.mapScene&&(this.mapScene=null),this.mapScene=new MapScene,t.target=this.mapScene,World.instance.addChildAt(t.target,0)},p.hideMap=function(){null!=this.mapScene?(console.log("hideMap"),this.clear(this.mapScene)):console.log("mapScene   had   not  instance")},p.showShengDiScene=function(){console.log("showShengDi"),null!=this.shengDiScene&&(this.shengDiScene=null),this.shengDiScene=new ShengDiScene,this.registerAndroidEvent(this.shengDiScene),t.target=this.shengDiScene,World.instance.addChildAt(t.target,0),CtrlScene.getInstance().showTop(),CtrlScene.getInstance().showCtrl()},p.hideShengDiScene=function(){null!=this.shengDiScene?(console.log("hideShengDi"),this.clear(this.shengDiScene)):console.log("shengDiScene   had   not  instance")},p.registerAndroidEvent=function(t){window.gameObj=t,window.keyConfirm=t.control,window.keyMenu=t.control,window.keyJump=t.control,window.keySkill1=t.control,window.keySkill2=t.control,window.keyAttack=t.control,window.keyLeft=t.control,window.keyUp=t.control,window.keyRight=t.control,window.keyDown=t.control},t}();egret.registerClass(UIManage,"UIManage");var World=function(t){function e(){if(t.call(this),this.world_speed=.05,null!=e.instance)throw new Error("World had been Instanced");e.instance=this,this.init()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.init=function(){CtrlScene.getInstance(),this.createWorldSystem(),e.P2World=this.world,this.addEventListener(egret.Event.ENTER_FRAME,this.flash,this)},p.createWorldSystem=function(){this.world=new p2.World,this.world.sleepMode=p2.World.BODY_SLEEPING,this.world.setGlobalStiffness(1e5),this.world.defaultContactMaterial.restitution=.1,this.world.gravity[0]=0,this.world.gravity[1]=-6},p.flash=function(){CtrlScene.getInstance().syncFun(),this.world.step(this.world_speed),null!=UIManage.target&&"function"==typeof UIManage.target.syncDisplay&&UIManage.target.syncDisplay()},p.control=function(t){console.log("this is World control")},e}(egret.DisplayObjectContainer);egret.registerClass(World,"World");